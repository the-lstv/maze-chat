<head>

    @manifest {
        title: "Chat";
        accent: "blue";
        style: "flat";
        theme: "dark";
        favicon: /logo.svg;
    }

    @resources {
        js: /js/client.js, /js/ui.js, /js/app.js, https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js;
        css: /css/main.css, /css/format.css;

        ls-js: tiny, color, tabs, resize, tooltips, toast, nav, modal;
        ls-css: base, ls-flat, tabs, resize, tooltips, toast, nav, modal;

        fonts: Montserrat, "JetBrains Mono";

        bootstrap-icons;
    }
</head>

<page>
    <main %main message-style="channel">

        <ls-tab %splash>
            <div .messageLoader></div>
        </ls-tab>


        <ls-tab %error>
            <ls-box ls-accent="red" class="fill">
                <i class="bi-bug-fill"></i>
            </ls-box>
        </ls-tab>


        <!-- temporary! -->
        <ls-tab %login .intro>

            <!-- <img src="https://cdn.extragon.cloud/file/670a4b9db1fd04d0c3daa0de7dc842fa.png?size=250" loading="lazy" alt="Chat bubbles" draggable="false"> -->

            <div style="text-align:center">
                <div style="font-size:2.5em;font-weight:900">
                    MazeChat
                </div>
                
                <h3 style="margin:0">Select how you want to continue:</h3>

                <br><br>

                <ls-box style="display:flex;flex-direction:column">
                    <a style="display: block; width: 100%" ls-accent="deep-orange" href="https://lstv.space/sso?app=11&ref=https%3A%2F%2Fchat.lstv.space%2Fauth-finish&permissions=16.w"><button style="width: 100%">Login with LSTV</button></a>
                </ls-box>

                <br><br>

                <b>(Bare with me till I make a proper login / setup screen.)</b>

                <br><br>

                <div style="width:450px;font-size:.8em;color:var(--elevate-3);text-align:left;"> <li>This product is considered <ls-box .inline .color ls-accent="purple">unreleased</ls-box>. It is pre-alpha and may not work as promised. No warranty or guarantees are made on its functionality, availability, reliability or the retention of your data.</li> <br> <li>Maze is a service provided by <ls-box .inline .color ls-accent="aquamarine">LSTV</ls-box> - same <a href="https://lstv.space/pp">Privacy Policy</a> and <a href="https://lstv.space/tos">Terms of Service</a> apply.</li> </div>
            </div>


            <br> <br>

        </ls-tab>

        <ls-tab %settings>
            <h1><i .bi-sign-turn-left-fill></i> work in progress</h1>
            <button onclick="app.screen.setActive('home')">go back</button>
        </ls-tab>

        <ls-tab %home>
            <div %list>
                <div %channelOrganizer>
                    <div %serverList ls-accent="auto">
                        <div style="opacity: .2" ls-tooltip="Coming soon" .serverIcon>
                            <i .bi-house-fill></i>
                        </div>
                        <div .selected ls-tooltip="Public channels" .serverIcon>
                            <i .bi-list-task></i>
                        </div>
                        <hr>
                        <div ls-accent="green" ls-tooltip="Join new servers/channels" onclick="app.joinServerModal.show()" .serverIcon>
                            <i .bi-plus-lg></i>
                        </div>
                    </div>
                    <div .list-items %channelList>
        
                    </div>
                </div>

                <div %profileBar>
                    <div .list-item onclick='app.showProfile(app.client.user.id, this.getBoundingClientRect().left + 15, this.getBoundingClientRect().top - (O("#profilePopup").getBoundingClientRect().height || 480) - 15)'>
                        <div .list-avatar></div>
                        <span .profileBarName></span>
                    </div>
                    <div .profileBarButtons>
                        <div ls-tooltip="Settings" onclick="app.screen.setActive('settings')" .list-item><i .bi-gear-fill></i></div>
                    </div>
                </div>
            </div>

            <ls-tabs %homeContents>
                <ls-tab %noChannel>
                    <i .bi-chat-dots></i>
                    <br>
                    <h3>Select a channel to start chatting!</h3>
                </ls-tab>

                <ls-tab %room>
                    <div %messageLoader>
                        <div .messageLoader></div>
                    </div>
    
                    <div %messageArea></div>
    
                    <div %messageButtons hidden>
                        <div onclick='LS.Toast.show("This feature is not implemented yet!", {accent: "red", timeout: 2000})' .messageButton ls-tooltip="React" .messageReactButton><i .bi-emoji-smile-fill></i></div>
                        <div onclick='LS.Toast.show("This feature is not implemented yet!", {accent: "red", timeout: 2000})' .messageButton ls-tooltip="Reply" .messageReplyButton><i .bi-reply-fill></i></div>
                        <div onclick="app.ui.activeMessageCopy()" .messageButton ls-tooltip="Copy text" .messageCopyButton><i .bi-clipboard-fill></i></div>
                        <div onclick="app.ui.activeMessageCopyID()" .messageButton ls-tooltip="Copy message ID" .messageCopyButton><i .bi-clipboard-data></i></div>
                        <div .messageButtonGroup .ownMessageButtons>
                            <div onclick="app.ui.activeMessageEdit()" .messageButton ls-tooltip="Edit" .messageEditButton><i .bi-pencil-fill></i></div>
                            <div onclick="app.ui.activeMessageDelete()" .messageButton ls-tooltip="Delete" .messageDeleteButton><i .bi-trash-fill></i></div>
                        </div>
                    </div>
    
                    <div %writingArea>
                        <div %typingUsers .hidden>
                            <div .typingDots></div>
                            <div .typingUsersText></div>
                        </div>
    
                        <ls-group join %messageBox>
                            <div role="button" .messageBoxButton>
                                <i .bi-plus-circle-fill></i>
                            </div>
    
                            <div %messageContent></div>
    
                            <div title="Emoji picker" role="button" onclick="app.ui.emojiPicker()" .messageBoxButton>
                                <i .bi-emoji-laughing-fill></i>
                            </div>
    
                            <div title="Send message" role="button" onclick="app.ui.send()" .messageBoxButton .sendButton>
                                <i .bi-send-fill></i>
                            </div>
                        </ls-group>
                    </div>
        
                </ls-tab>

            </ls-tabs>

            <div %memberList style="display: none">
                <div .list-items>

                </div>
            </div>
        </ls-tab>

    </main>

    <div %assets hidden>
        <div %profilePopup .profile-view hidden>
            <ls-box ls-tooltip="This account belongs to a bot" .color .bot-tag .profile-bot-badge accent="blue"><i .bi-robot></i> BOT</ls-box>

            <div .profile-banner>
                <img draggable="false">
                <video loop autoplay muted></video>
            </div>

            <div .profile-avatar>
                <img draggable="false">
            </div>

            <div .profile-box>
                <h2 .profile-name></h2>
                <div .profile-bio></div>
            </div>
        </div>

        <div %messageEditPanel>
            <div %messageEditContent></div>
            <span style="color: gray; font-size: small; display: inline-block; padding: 4px 10px;">
                escape to cancel, enter to confirm
            </span>
        </div>

        <ls-modal %joinChatModal>
            <ls-modal-body>
                <h2 .ls-modal-title>Hop into a new conversation! (Coming soon)</h2>
                <div .ls-modal-content>
                    <b>Coming soon.</b> In the meantime, you can join a public channel (NOT a server) directly below. <br><br>

                    <ls-group join>
                        <input style="width: 100%" type="text" %publicChannelID placeholder="Enter public channel ID">
                        <button %publicChannelJoin>Join</button>
                    </ls-group>

                    <br>

                    (This is only TEMPORARY).
                    
                    <script>
                        // Temporary

                        O("#publicChannelJoin").on("click", async () => {
                            let resonse = await app.client.request("/join", {
                                method: "POST",
                                body: JSON.stringify({
                                    channel: +O("#publicChannelID").value
                                })
                            }).json()

                            if(!resonse.success){
                                LS.Modal.build({title:"Could not join channel", content: "Are you sure the channel exists and you have permissions to join it?\n(And also that you arent already a member of this channel)", buttons: ["ok"]}).show()
                            } else {
                                LS.Modal.build({title:"Success", content: "Public channel joined", buttons: ["ok"]}).show()
                                app.joinServerModal.close()
                                app.temporary_renderPubliChannels()
                            }
                        })
                    </script>
                </div>
            </ls-modal-body>
            <ls-modal-footer>
                <button onclick="app.joinServerModal.close()">Cancel</button>
            </ls-modal-footer>
        </ls-modal>
    </div>

    <style>
        /* Styles that have to be available immediately */
        :root {
            --font: Montserrat;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            margin: 0;
            box-sizing: border-box;
        }
    </style>
</page>